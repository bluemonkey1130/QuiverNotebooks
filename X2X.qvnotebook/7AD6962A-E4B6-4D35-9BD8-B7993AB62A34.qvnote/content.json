{
  "title": "Script player",
  "cells": [
    {
      "type": "text",
      "data": "HTML"
    },
    {
      "type": "code",
      "language": "html",
      "data": "<script src=\"https://www.youtube.com/iframe_api\"></script>\n<script src=\"https://player.vimeo.com/api/player.js\"></script>\n<script src=\"/assets/js/can-autoplay.3.0.2.js\"></script>\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/video.js/7.15.0/alt/video-js-cdn.min.css\" integrity=\"sha512-RU6FIpN8MZ6jrswHMYzP9t7QlAtDkpCJP6uqyHYm56iP6eEdYCDfMW2C42KtimtJ8DKa+iWJqjpeTyLyQjV61g==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/font-awesome-line-awesome/css/all.min.css\" integrity=\"sha512-dC0G5HMA6hLr/E1TM623RN6qK+sL8sz5vB+Uc68J7cBon68bMfKcvbkg6OqlfGHo1nMmcCxO5AinnRTDhWbWsA==\" crossorigin=\"anonymous\" referrerpolicy=\"no-referrer\" />\n\n<div id=\"playerTemplate\" class=\"player\">\n    <div class=\"close\"><i class=\"fa fa-times\"></i></div>\n    <div class=\"shuffle prev\"><i class=\"fa fa-angle-left\"></i></div>\n    <div class=\"shuffle next\"><i class=\"fa fa-angle-right\"></i></div>\n    <div class=\"label\">\n        <div class=\"inner\">\n            <div class=\"name\"></div>\n            <div class=\"sub\"></div>\n            <div class=\"description\"></div>\n        </div>\n    </div>\n    <div class=\"frame\">\n        <div class=\"loading\"></div>\n        <div class=\"video\"></div>\n        <div class=\"play\"></div>\n        <div class=\"nav\">\n            <div class=\"control play\"></div>\n            <div class=\"control mute\"></div>\n            <div class=\"seek\">\n                <div class=\"bg\"></div>\n                <div class=\"loaded\"></div>\n                <div class=\"position\"></div>\n            </div>\n            <div class=\"time\"></div>\n            <div class=\"control fullscreen\"></div>\n        </div>\n    </div>\n</div>"
    },
    {
      "type": "text",
      "data": "Script"
    },
    {
      "type": "code",
      "language": "javascript",
      "data": "let player=(()=>{\n    let init=()=>{\n        $(()=>{\n            /*\n            list.init({\n                path : \"/getassetgroupjson?guid=94548b7a-fb95-4e21-a889-a36041e68569\",\n                container: $(\".gallery\"),\n                pageLength : 50,\n                customTableRender : (data, page, pageLength)=>{\n                    var $list = $(\"<div class=\\\"pure-g\\\"></div>\");\n                    \n                    for(i=(page - 1) * pageLength; (i<((page) * pageLength)) && i<data.length; i++){\n                        var asset = data[i];\n                        var frame = $(\"<div class=\\\"pure-u-1 pure-u-sm-1-2 pure-u-md-1-2 pure-u-lg-1-3 pure-u-xl-1-4\\\"></div>\");\n                        var tile = $(\"<div class=\\\"tile\\\" data-videoid=\\\"\" + asset.Var1 + \"\\\"><div class=\\\"image\\\" style=\\\"background-image: url(/?action=asset&id=\" + asset.Guid + \")\\\"></div><div class=\\\"relativefont\\\" data-relative-font-factor=\\\"40\\\"><div class=\\\"label\\\"><div class=\\\"name\\\">\" + asset.Name + \"</div><div class=\\\"sub\\\">\" + (asset.Var2??\"&nbsp;\") + \"</div><button>\" + asset.Var3 + \"</button></div></div>\");\n                        tile.data(\"asset\", asset);\n                        frame.append(tile);\n                        $list.append(frame);\n                    }\n                    \n                    return $list;\n                },\n                onRefresh : ()=> {\n                    $(window).resize();\n                    attachHandlers();\n                },\n                onLoad : (data)=>{\n                    initRelativeFont();\n                    $(window).resize();\n                    preloadImages(data);\n                    initAutoplay();\n                }\n            });\n            */\n            \n            initResize();\n            //initAutoplay();\n            //initControls();\n        });\n    },\n    isActive=false,\n    assets,\n    initResize=()=>{\n        $(window).resize(()=>{\n            var rect = $(\".player .frame\")[0].getBoundingClientRect();\n            $(\".player .close\").height(rect.top);\n            $(\".player .label\").height($(window).height() - rect.bottom);\n        }).resize();\n    },\n    controlTimer,\n    isControlsVisible=true,\n    initControls=()=>{\n        $(\".player\").on(\"mousemove\",()=>{\n            if(isControlsVisible){\n                clearTimeout(controlTimer);\n                controlTimer = setTimeout(hideControls, 3000);\n            }\n            else\n            {\n                showControls();\n            }\n        });\n    },\n    hideControls=()=>{\n        isControlsVisible=false;\n        $(\".player .nav\").animate({opacity : 0},750);\n    },\n    showControls=()=>{\n        isControlsVisible=true;\n        $(\".player .nav\").animate({opacity : 1},250);\n    },\n    preloadImages=(data)=>{\n        data.forEach(asset=>{\n            $(\"<img src=\\\"/?action=asset&id=\" + asset.Guid + \"\\\">\");\n        });\n    },\n    attachHandlers=()=>{\n        $(\".gallery .tile\").click(tileClickHandler);\n    },\n    tileClickHandler=(e)=>{\n        createPlayer($(e.currentTarget).data().asset);\n    },\n    player,\n    createPlayer=(asset)=>{\n        resetControls();\n        \n        //determin if video id is vimeo or yt\n        if(isNaN(asset.Var1))\n            createYTPlayer(asset.Var1);\n        else\n            createVimeoPlayer(asset.Var1);\n            \n        player.asset=asset;\n        updateLabels(asset);\n        isActive=true;\n    },\n    createYTPlayer=(id)=>{\n        $(\".player .video\").html(\"<div></div>\").removeClass(\"vimeo\").addClass(\"yt\");\n        \n        player = new YT.Player($(\".player .video div\")[0],{\n            videoId : id,\n            playerVars: { \n                'autoplay': autoplay ? 1 : 0,\n                'controls': 0,\n                \"showinfo\" : 0,\n                'rel' : 0,\n                'fs' : 0,\n                \"modestbranding\" : 1,\n                \"playsinline\" : 1,\n                \"allowfullscreen\" : 1\n            },\n            events : {\n                \"onStateChange\" : ytStateChange,\n                \"onReady\" : ()=>{\n                    if(isMuted) player.mute();\n                    onLoaded();\n                }\n            }\n        });\n        \n        player.playerType=\"yt\";\n        \n        playerTimer = setInterval(ytTimeUpdate,100);\n        \n        bindControls();\n        \n        showPlayer();\n    },\n    playerTimer,\n    ytTimeUpdate=()=>{\n        var currentTime = player.getCurrentTime(),\n        duration = player.getDuration(),\n        percent = currentTime / duration;\n        updatePosition(percent);\n        if(player.getPlayerState()==2)\n            $(\".player .nav .play\").removeClass(\"playing\");\n        else\n            $(\".player .nav .play\").addClass(\"playing\");\n        $(\".player .nav .loaded\").width((player.getVideoLoadedFraction() * 100) + \"%\");\n        updateTime(duration - currentTime);\n    },\n    ytStateChange=(e)=>{\n        if(e.data==0)\n            playNext();\n    },\n    createVimeoPlayer=(id)=>{\n        $(\".player .video\").html(\"<div></div>\").removeClass(\"yt\").addClass(\"vimeo\");\n        player = new Vimeo.Player($(\".player .video div\")[0], {\n            id : id,\n            autoplay : autoplay,\n            controls : false,\n            transparent : false,\n            playsinline : true\n        });\n        player.playerType=\"vimeo\";\n        player.on(\"timeupdate\", vimeoTimeUpdate);\n        player.on(\"ended\", vimeoEnded);\n        player.on(\"progress\", vimeoProgress);\n        player.on(\"loaded\", onLoaded);\n        player.on(\"play\", hideLoading);\n        playerTimer = setInterval(vimeoStatusUpdate,100);\n        \n        if(isMuted)\n            player.setVolume(0);\n        else\n            player.setVolume(1);\n        \n        bindControls();\n        \n        showPlayer();\n    },\n    vimeoTimeUpdate=(e)=>{\n        updatePosition(e.percent);\n        updateTime(e.duration - e.seconds);\n    },\n    vimeoStatusUpdate=()=>{\n        player.getPaused().then(paused=>{\n            if(paused)\n                $(\".player .nav .play\").removeClass(\"playing\");\n            else\n                $(\".player .nav .play\").addClass(\"playing\");\n        });\n    },\n    vimeoEnded=()=>{\n        playNext();\n    },\n    vimeoProgress=e=>{\n        $(\".player .nav .loaded\").width((e.percent * 100) + \"%\");\n    },\n    updateLabels=(asset)=>{\n        $(\".player .name\").html(asset.Name.toUpperCase());\n        $(\".player .description\").html(asset.Content);\n        $(\".player .sub\").html(asset.Var2);\n        $(window).resize();\n    },\n    updatePosition=(percent)=>{\n        $(\".player .seek .position\").width((percent * 100) + \"%\");\n    },\n    updateTime=seconds=>{\n        if(seconds < 0) seconds = 0;\n        var time = { \n            minutes : Math.floor(seconds / 60),\n            seconds : seconds % 60\n        };\n        $(\".player .nav .time\").text(\"-\" + time.minutes + \":\" + Math.floor(time.seconds).toString().padStart(2,\"0\"));\n        \n    },\n    playPause=()=>{\n        if(player.playerType==\"vimeo\"){\n            player.getPaused().then(paused=>{\n                if(paused){\n                    player.play();\n                    hideBigPlay();\n                }\n                else\n                    player.pause();\n            });\n        }\n        else{\n            if(player.getPlayerState() == 1)\n                player.pauseVideo()\n            else{\n                player.playVideo();\n                hideBigPlay();\n            }\n        }\n            \n    },\n    isMuted = false,\n    mute=()=>{\n        var \n        setMuted=()=>{\n            $(\".player .nav .mute\").addClass(\"muted\");\n            isMuted = true\n        },\n        clearMuted=()=>{\n            $(\".player .nav .mute\").removeClass(\"muted\");\n            isMuted = false;\n        };\n        \n        if(player.playerType==\"vimeo\"){\n            player.getVolume().then(vol=>{\n                if(vol != 0){\n                    player.setVolume(0);\n                    setMuted();\n                }\n                else{\n                    player.setVolume(1);\n                    clearMuted();\n                }\n            });\n        }\n        else{\n            if(player.isMuted()){\n                player.unMute();\n                clearMuted();\n            }\n            else{\n                player.mute();\n                setMuted();\n            }\n        }\n    },\n    fullscreen=()=>{\n        target = $(\".player iframe\")[0];\n        switch(true){\n            case target.requestFullScreen != undefined:\n                target.requestFullScreen();\n                break;\n            case target.webkitRequestFullscreen != undefined:\n                target.webkitRequestFullscreen();\n                break;\n            case target.mozRequestFullScreen != undefined:\n                target.mozRequestFullScreen();\n                break;\n            case target.webkitRequestFullscreen != undefined:\n                target.webkitRequestFullscreen();\n                break;\n            case player.requestFullscreen != undefined:\n                player.requestFullscreen();\n                break;\n        }\n        hideBigPlay();\n    },\n    seek=(e)=>{\n        if(e.buttons==0 && e.which == 0) return;\n        rect = e.currentTarget.getBoundingClientRect();\n        percent = (e.clientX - rect.left) / rect.width;\n        \n        if(player.playerType==\"vimeo\"){\n            player.getDuration().then(duration=>{\n                var seconds = duration * percent;\n                player.setCurrentTime(seconds);\n                updateTime(seconds);\n                updatePosition(percent);\n            });\n        }\n        else{\n            var seconds = player.getDuration() * percent;\n            player.seekTo(seconds);\n            updateTime(seconds);\n        }\n        \n        \n        \n    },\n    assertControls=()=>{\n        if(assets==undefined){\n            $(\".player\").addClass(\"single\");\n        }\n    },\n    bindControls=()=>{\n        unbindControls();\n        assertControls();\n        $(\".player .nav .play\").click(playPause);\n        $(\".player .nav .mute\").click(mute);\n        $(\".player .nav .fullscreen\").click(fullscreen);\n        $(\".player .close\").click(closePlayer);\n        $(\".player .seek\").click(seek).on(\"mousemove\",seek);\n        $(\".player .next\").click(playNext);\n        $(\".player .prev\").click(playPrevious);\n        $(\".player .frame > .play\").click(bigPlayClickHandler);\n    },\n    unbindControls=()=>{\n        $(\".player .nav .play, .player .nav .mute, .player .nav .fullscreen, .player .close, .player .seek, .player .next, .player .prev, .player .frame > .play\").off(\"click\");\n    },\n    closePlayer=()=>{\n        if(player.playerType==\"vimeo\"){\n            player.pause();\n        }\n        else{\n            player.pauseVideo();\n        }\n        clearInterval(playerTimer);\n        hidePlayer();\n        hideBigPlay();\n        player.destroy();\n        isActive=false;\n    },\n    getNextAsset=()=>{\n        index=assets.indexOf(player.asset);\n        if(index==(assets.length-1)) return assets[0];\n        return assets[index+1];\n    },\n    getPreviousAsset=()=>{\n        index=assets.indexOf(player.asset);\n        if(index==0) return assets[assets.length-1];\n        return assets[index-1];\n    },\n    playNext=()=>{\n        clearInterval(playerTimer);\n        createPlayer(getNextAsset())\n        hideBigPlay();\n    },\n    playPrevious=()=>{\n        clearInterval(playerTimer);\n        createPlayer(getPreviousAsset());\n        hideBigPlay();\n    },\n    resetControls=()=>{\n        $(\".player .seek .position, .player .nav .loaded\").width(0);\n        $(\".player .play\").removeClass(\"playing\");\n        $(\".player .nav .time\").text(\"-0:00\");\n        $(\".player .frame .loading\").show();\n    },\n    onLoaded=()=>{\n        hideLoading();\n        //play if available\n        canAutoplay.video().then(e=>{\n            if(e.result && isActive){\n                playPause()\n            }\n            else {\n                showBigPlay();\n            }\n        });\n        \n    }\n    hideLoading=()=>{\n        $(\".player .frame .loading\").hide();\n        \n        /*\n        //show big play if video not playing after delay\n        if(player.playerType==\"vimeo\"){\n            setTimeout(()=>{\n                player.getPaused().then(paused=>{\n                    if(paused){\n                        showBigPlay();\n                    }\n                })\n            },1500);\n        }\n        */\n        \n        //if(!autoplay) showBigPlay();\n        //autoplay=true;\n    },\n    hideLoadingDelay=()=>{\n        setTimeout(hideLoading,1000);\n        //$(\".player .video iframe\").attr(\"webkitallowfullscreen\",\"true\").attr(\"mozallowfullscreen\",\"true\");\n    },\n    autoplay=false,\n    initAutoplay=()=>{\n        play=$.getQueryParameters().play;\n        if(play!=undefined){\n            getName=n=>{\n                if(n==null || n==undefined) return \"\";\n                return n.replace(/:/g,\"\").replace(/'/g,\"\").replace(/\\(/g,\"\").replace(/\\)/g,\"\").replace(/-/g,\" \").replace(/\\./g,\" \").replace(/,/g,\"\").replace(/!/g,\"\").replace(/&/g,\"and\");\n            }\n            play=play.replace(/-/g,\" \");\n            //autoplay=false;\n            asset = assets.find(a=>getName(a.Name).toLowerCase()==play.toLowerCase());\n            \n            if(asset!=undefined)\n                createPlayer(asset);\n            //$($(\".gallery .tile\").toArray().find(e=>$(e).data().asset.Name.toLowerCase()==play)).click();\n        }\n    },\n    showBigPlay=()=>{\n        $(\".player .frame > .play\").show();\n        if(player.playerType==\"vimeo\"){\n            showBigPlayTimer = setInterval(()=>{\n                player.getPaused().then(paused=>{\n                    if(!paused){\n                        hideBigPlay();\n                        clearInterval(showBigPlayTimer);\n                    }\n                })\n            },200);\n        }\n    },\n    hideBigPlay=()=>{\n        $(\".player .frame > .play\").hide();\n    },\n    bigPlayClickHandler=()=>{\n        playPause();\n    },\n    showPlayer=()=>{\n        if($(\".player\").css(\"display\")!=\"block\"){\n            gsap.set(\".player\", {opacity:0, duration: 0.7,  display:\"block\"});\n            gsap.to(\".player\", { opacity:1 })\n        }\n        //$(\".player\").css({opacity:0}).show().animate({opacity:1},500);\n    },\n    hidePlayer=()=>{\n        gsap.to(\".player\", {opacity:0, duration: 0.7, onComplete: ()=>{ gsap.set(\".player\", {display: \"none\"}); }});\n        //$(\".player\").animate({opacity:0},500,);\n    }\n    \n    ;  \n    init();\n    return {\n        createPlayer : (asset)=>{createPlayer(asset);},\n        setAssets: (data)=>{assets = data;},\n        initAutoplay: ()=>{initAutoplay();},\n        getPlayer: ()=>{return player;}\n    };\n})();"
    },
    {
      "type": "text",
      "data": "Style"
    },
    {
      "type": "code",
      "language": "css",
      "data": ".player{\n    position: fixed;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    background: #222;\n    display:none;\n    z-index: 20000;\n    color: #fff;\n}\n\n.player .frame{\n    left: 50%;\n    position: absolute;\n    top: 45%;\n    transform: translate(-50%,-50%);\n    width: 65%;\n    background: #000;\n    padding-bottom: 37%;\n}\n\n.player .frame .loading{\n    height: 100%;\n    width: 100%;\n    position: absolute;\n    background-image: url(/?action=asset&id=8251dbc9-5c3e-4311-ad37-10af96e3b895);\n    z-index: 1;\n    background-repeat: no-repeat;\n    background-position: center;\n}\n\n.player .video{\n    height: 100%;\n    width: 100%;\n    position: absolute;\n}\n\n.player .video iframe{\n    width: 100%;\n    height: 100%;\n}\n\n.player .video.vimeo iframe{\n\n}\n\n.player .video.vimeo > div{\n    height: 100%;\n}\n\n.player .video.yt iframe{\n\n}\n\n.nav{\n    position: absolute;\n    bottom: -4em;\n    width: 100%;\n}\n\n.player .nav .control, .player .close{\n    font-family: VideoJS;\n    font-weight: 400;\n    font-style: normal;\n    font-size: 1.8em;\n    line-height: 1.67;\n    display: inline-block;\n}\n\n.player .nav .play{\n    \n}\n\n.player .nav .play:before{\n    content: \"\\F101\";\n}\n\n.player .nav .play.playing:before{\n    content: \"\\F103\";\n}\n\n.player .nav .mute{\n    \n}\n\n.player .nav .mute:before{\n    content: \"\\F107\";\n}\n\n.player .nav .mute.muted:before{\n    content: \"\\F104\";\n}\n\n.player .nav .time{\n    display: inline-block;\n    width: 3em;\n    height: 1em;\n    position: relative;\n    top: -0.9em;\n    font-family: 'Lato';\n    font-weight: 300;\n    font-size: 0.8em;\n    padding-left: 2em;\n}\n\n.player .nav .fullscreen{\n    float: right;\n}\n\n.player .nav .fullscreen:before{\n    content: \"\\F108\";\n}\n\n.player .close{\n    position: absolute;\n    right: 0;\n    font-size: 2.5em;\n    width: 17.5%;\n    cursor: pointer;\n    z-index: 2;\n}\n\n.player .close i{\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%,-50%);\n}\n\n.player .frame > .play{\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    display: none;\n    background-image: url(/?action=asset&id=31af64e5-d3df-4262-9a10-0433d8989a70);\n    background-repeat: no-repeat;\n    background-position: center;\n    background-size: 8em;\n}\n\n.player .label{\n    font-family: Lato;\n    position: absolute;\n    width: 100%;\n    text-align: center;\n    font-weight: 400;\n    letter-spacing: 0.15em;\n    bottom: 0;\n}\n\n.player .label .inner{\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%,-50%);\n    width: 100%;\n}\n\n.player .name{\n}\n\n.player .sub{\n    font-weight: 300;\n    padding: 1em 0;\n    letter-spacing: 0.1em;\n}\n.player .description{\n    letter-spacing: 0.1em;\n    font-weight: 300;\n    padding: 0 1em;\n}\n\n.player .nav .seek{\n    display: inline-block;\n    width: calc(100% - 118px - 4em);\n    position: relative;\n    height: 2em;\n}\n\n.player .nav .seek .bg{\n    height: 2px;\n    background: #333;\n    width: 100%;\n    position: absolute;\n    top: 1em;\n}\n\n.player .nav .seek .loaded{\n    height: 2px;\n    background: #555;\n    position: absolute;\n    width: 0;\n    top: 1em;\n}\n\n.player .nav .seek .position{\n    height: 2px;\n    background: #fff;\n    position: absolute;\n    width: 0;\n    top: 1em;\n}\n\n.player .nav .seek .handle{\n    \n}\n\n.player .nav .seek .handle:after{\n    font-family: VideoJS;\n    font-weight: 400;\n    font-style: normal;\n    font-size: 0.6em;\n    display: inline-block;\n    content: \"\\f111\";\n    position: absolute;\n    top: -4px;\n    right: -4px;\n}\n\n.player .shuffle{\n    position: absolute;\n    top: 45%;\n    font-size: 2.5em;\n    cursor: pointer;\n    width: 17.5%;\n    text-align: center;\n    transform: translateY(-50%);\n    display: block !important;\n    height: 1em;\n}\n\n.player .prev{\n    left: 0;\n}\n\n\n\n.player .next{\n    right: 0;\n}\n\n.player.single .next,\n.player.single .prev{\n    display:none !important;\n}\n\n/* pure-font-xs */\n@media screen and (max-width:35.438em) {\n\n    .player .close {\n        top: 0.7em;\n        font-size: 1.5em;\n    }\n    \n    .player .shuffle{\n        font-size: 1.5em;\n    }\n    \n    .player .description {\n        font-size: 0.8em;\n    }\n}\n/* pure-font-sm */\n@media screen and (min-width:35.5em) and (max-width:47.938em) {\n\n}\n/* pure-font-md */\n@media screen and (min-width:48em) and (max-width:63.938em) {\n\n}\n/* pure-font-lg */\n@media screen and (min-width:64em) and (max-width:79.938em) {\n\n}\n/* pure-font-xl */\n@media screen and (min-width:80em) {\n\n}\n\n\n@media screen and (max-height:35.438em) {\n    .player .frame {\n        top: 1em;\n        transform: translate(-50%,0%);\n        width: 50%;\n        padding-bottom: 28%;\n    }\n    \n    .nav {\n        bottom: -3em;\n    }\n    \n    .player .close {\n        top: 0.7em;\n        font-size: 1.5em;\n    }\n    \n    .player .shuffle{\n        font-size: 1.5em;\n    }\n    \n    .player .label{\n        bottom: 1em;\n    }\n    \n    .player .name {\n        margin-bottom: 0.5em;\n    }\n    \n    .player .description {\n        font-size: 0.8em;\n    }\n\n}\n\n\n\n"
    }
  ]
}